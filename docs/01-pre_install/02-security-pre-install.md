# OpenClaw Preparation Guide (Docker + Bridge Edition)

> [!NOTE]
> This guide is tailored for the **Docker + Keyboard Maestro Bridge** setup.

Before installing OpenClaw, follow these steps to secure your host machine, protect your API keys, and prepare the bridge interface.

## 1. Secure API Key Management

Never hardcode API keys in scripts or configuration files that might be shared.

### Method: The `.env` File (Docker Preferred)
Create a `.env` file in your OpenClaw root directory (`~/clawfather`).
1. Create the file: `touch ~/clawfather/.env`
2. Add your keys (Anthropic, Gemini, Z.ai, etc.).
3. **CRITICAL**: Ensure `.env` is in your `.gitignore` if you are using git.

---

## 2. Bridge & Keyboard Maestro Security

Since you are using Keyboard Maestro (KM) as a bridge to allow Docker to control your Mac, you must secure this connection.

### 1. Secure the KM Web Server
The KM Web Server allows *anyone* on your local network to trigger macros if not secured.
*   **Enable Authentication**: In KM Preferences > Web Server, set a **Username** and **Password**.
*   **Restrict Port**: Ensure the port (default `4490`) is not forwarded on your router.

### 2. Verify Macro Safety
Review the macros you expose to the web server trigger.
*   **Safe**: "Play Music", "Open App", "Resize Window".
*   **Dangerous**: "Run Shell Script", "Delete File", "Type Keystroke".
*   **Restriction**: Only enable the "Public Web Entry" trigger for macros you *specifically* want the AI to control.

---

## 3. Docker Host Preparation

### Workspace Isolation
Create a dedicated folder for OpenClaw's mapped volumes.
```bash
mkdir -p ~/clawfather
chmod 700 ~/clawfather
```
This ensures other users on your Mac cannot read the agent's config or skills.

### TCC Permissions (For Keyboard Maestro Engine)
Since Docker talks to KM, the **Keyboard Maestro Engine** application on your Mac needs permissions, not Docker itself.
Go to **System Settings > Privacy & Security** and ensure **Keyboard Maestro Engine** has:
*   **Accessibility**: Required to manipulate windows/UI.
*   **Automation**: Required to control other apps (Music, Mail).

---

## 4. Preventing Accidental Deletion (Host Side)

Even though OpenClaw runs in Docker, if you mount your `~/Projects` folder, it *can* delete your files.

### Install `trash`
We recommend installing `trash` on your Mac so you can recover files if you manually run cleanup scripts generated by the AI.
```bash
brew install trash
```

> [!IMPORTANT]
> Within the Docker container, `Safe Mode` should be enabled in your `docker-compose.yml` (`SAFE_MODE=true`) to prevent the agent from running `rm -rf`.
